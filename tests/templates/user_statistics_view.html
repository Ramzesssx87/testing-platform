<!-- tests/templates/user_statistics_view.html -->
{% extends 'base.html' %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - {{ target_user.profile.get_short_name }}{% endblock %}

{% block content %}
<div class="statistics-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ target_user.profile.get_short_name }}</h1>
        <a href="{% url 'group_results' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –≥—Ä—É–ø–ø—ã</a>
    </div>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
    <div class="card mb-4">
        <div class="card-body">
            <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>–§–ò–û:</strong> {{ target_user.profile.get_full_name|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}</p>
                    <p><strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong> {{ target_user.username }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>–ö–æ–¥ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:</strong> {{ target_user.profile.department_code|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</p>
                    <p><strong>–ò–µ—Ä–∞—Ä—Ö–∏—è:</strong> {{ target_user.profile.get_department_hierarchy }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">{{ total_trainings }}</h5>
                    <p class="card-text">–í—Å–µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">{{ average_training_last_10 }}%</h5>
                    <p class="card-text">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">{{ total_express_tests }}</h5>
                    <p class="card-text">–ó–∞–≤–µ—Ä—à–µ–Ω–æ –≠–∫—Å–ø—Ä–µ—Å—Å –¢–µ—Å—Ç–æ–≤</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">{{ average_express_last_10 }}%</h5>
                    <p class="card-text">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç–æ–≤</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h5>
            <span class="badge bg-primary">–í—Å–µ–≥–æ: {{ total_trainings }}</span>
        </div>
        <div class="card-body">
            {% if training_tests_limited %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>–¢–µ—Å—Ç</th>
                            <th>–î–∞—Ç–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</th>
                            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                            <th>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</th>
                            <th>–î–∏–∞–ø–∞–∑–æ–Ω –≤–æ–ø—Ä–æ—Å–æ–≤</th>
                            <th>–¢–∏–ø —Ç–µ—Å—Ç–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for test in training_tests_limited %}
                        <tr>
                            <td>{{ test.test.name }}</td>
                            <td>{{ test.completed_at|date:"d.m.Y H:i" }}</td>
                            <td>
                                <span class="badge {% if test.score >= 80 %}bg-success{% elif test.score >= 60 %}bg-warning{% else %}bg-danger{% endif %}">
                                    {{ test.score|floatformat:1 }}%
                                </span>
                            </td>
                            <td>{{ test.correct_answers_count }}/{{ test.total_questions_count }}</td>
                            <td>
                                {% if test.start_question and test.end_question %}
                                    –í–æ–ø—Ä–æ—Å—ã {{ test.start_question }}-{{ test.end_question }}
                                {% elif test.start_question %}
                                    –° –≤–æ–ø—Ä–æ—Å–∞ {{ test.start_question }}
                                {% elif test.end_question %}
                                    –î–æ –≤–æ–ø—Ä–æ—Å–∞ {{ test.end_question }}
                                {% else %}
                                    –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã
                                {% endif %}
                            </td>
                            <td>
                                <span class="badge {% if test.test_type == 'express' %}bg-warning{% else %}bg-info{% endif %}">
                                    {{ test.get_test_type_display }}
                                </span>
                            </td>
                            <td>
                                <a href="{% url 'user_test_results' target_user.id test.test.id %}?attempt_id={{ test.attempt_id }}" 
                                   class="btn btn-sm btn-outline-primary">
                                    –î–µ—Ç–∞–ª–∏
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if has_more_trainings %}
            <div class="text-center mt-3">
                <small class="text-muted">–ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏–∑ {{ total_trainings }}</small>
            </div>
            {% endif %}
            {% else %}
            <div class="text-center py-4">
                <p class="text-muted">–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.</p>
            </div>
            {% endif %}
        </div>
    </div>
    
    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤ -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5>‚ö° –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤</h5>
            <span class="badge bg-primary">–í—Å–µ–≥–æ: {{ total_express_tests }}</span>
        </div>
        <div class="card-body">
            {% if express_tests_limited %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>–¢–µ—Å—Ç</th>
                            <th>–î–∞—Ç–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</th>
                            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                            <th>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for test in express_tests_limited %}
                        <tr>
                            <td>{{ test.test.name }}</td>
                            <td>{{ test.completed_at|date:"d.m.Y H:i" }}</td>
                            <td>
                                <span class="badge {% if test.score >= 80 %}bg-success{% elif test.score >= 60 %}bg-warning{% else %}bg-danger{% endif %}">
                                    {{ test.score|floatformat:1 }}%
                                </span>
                            </td>
                            <td>{{ test.correct_answers_count }}/{{ test.total_questions_count }}</td>
                            <td>{{ test.total_questions_count }} –≤–æ–ø—Ä–æ—Å–æ–≤</td>
                            <td>
                                <a href="{% url 'user_test_results' target_user.id test.test.id %}?attempt_id={{ test.attempt_id }}" 
                                   class="btn btn-sm btn-outline-primary">
                                    –î–µ—Ç–∞–ª–∏
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if has_more_express %}
            <div class="text-center mt-3">
                <small class="text-muted">–ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 —ç–∫—Å–ø—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤ –∏–∑ {{ total_express_tests }}</small>
            </div>
            {% endif %}
            {% else %}
            <div class="text-center py-4">
                <p class="text-muted">–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —ç–∫—Å–ø—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .statistics-container {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .card {
        margin-bottom: 20px;
    }
    
    .table th {
        background-color: #f8f9fa;
    }
    
    .badge {
        font-size: 0.8em;
    }
    
    .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }
</style>
{% endblock %}