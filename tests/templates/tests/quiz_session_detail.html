{% extends 'base.html' %}

{% block title %}–ó–∞—á–µ—Ç: {{ quiz_session.test.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>–ó–∞—á–µ—Ç: {{ quiz_session.test.name }}</h1>
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="{% url 'quiz_sessions' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞—á–µ—Ç–∞–º</a>
        {% if is_creator %}
            <a href="{% url 'quiz_session_results' quiz_session.id %}" class="btn btn-info">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
            <div class="mt-3">
                {% if quiz_session.is_active %}
                    <a href="{% url 'update_quiz_participants' quiz_session.id %}" class="btn btn-info">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                    </a>
                    <small class="text-muted d-block mt-1">
                        –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≥—Ä—É–ø–ø—ã –≤ —ç—Ç–æ—Ç –∑–∞—á–µ—Ç
                    </small>
                {% endif %}
            </div>
        {% endif %}
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—á–µ—Ç–µ</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>–¢–µ—Å—Ç:</strong> {{ quiz_session.test.name }}</p>
                    <p><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤:</strong> {{ quiz_session.question_count }}</p>
                    <p><strong>–õ–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏:</strong> {{ quiz_session.time_limit_minutes }} –º–∏–Ω—É—Ç</p>
                </div>
                <div class="col-md-6">
                    <p><strong>–ù–∞—á–∞–ª–æ:</strong> {{ quiz_session.starts_at|date:"d.m.Y H:i" }}</p>
                    <p><strong>–û–∫–æ–Ω—á–∞–Ω–∏–µ:</strong> {{ quiz_session.ends_at|date:"d.m.Y H:i" }}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
                        {% if quiz_session.is_active %}
                            <span class="text-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                            {% if quiz_session.manually_activated %}
                                <small class="text-muted">(–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤—Ä—É—á–Ω—É—é)</small>
                            {% else %}
                                <small class="text-muted">(–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</small>
                            {% endif %}
                        {% else %}
                            <span class="text-warning">–û–∂–∏–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è -->
            {% if is_creator and not quiz_session.is_active %}
                <div class="mt-3">
                    <a href="{% url 'start_quiz_session' quiz_session.id %}" class="btn btn-success">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–∞—á–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ</a>
                    <small class="text-muted d-block mt-1">
                        –ó–∞—á–µ—Ç –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ {{ quiz_session.starts_at|date:"d.m.Y H:i" }} –∏–ª–∏ –≤—ã –º–æ–∂–µ—Ç–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Å–µ–π—á–∞—Å
                    </small>
                </div>
            {% elif is_creator and quiz_session.is_active %}
                <div class="alert alert-success mt-3">
                    <strong>–ó–∞—á–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!</strong> 
                    {% if quiz_session.manually_activated %}
                        –í—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –∑–∞—á–µ—Ç –≤—Ä—É—á–Ω—É—é. –£—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
                    {% else %}
                        –ó–∞—á–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é. –£—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ù–ï –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö —Ç–µ—Å—Ç -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">–£—á–∞—Å—Ç–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ç–µ—Å—Ç</h5>
        </div>
        <div class="card-body">
            {% with not_completed=participants|dictsort:"user.profile.last_name" %}
                {% if not_completed %}
                    <div class="list-group">
                        {% for participant in not_completed %}
                            {% if not participant.completed_at %}
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">
                                                {{ participant.user.profile.last_name }} 
                                                {{ participant.user.first_name|first }}.
                                                {% if participant.user.profile.patronymic %}
                                                    {{ participant.user.profile.patronymic|first }}.
                                                {% endif %}
                                            </h6>
                                            <p class="mb-1">
                                                {% if quiz_session.is_active %}
                                                    <span class="text-warning">–ú–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                                                {% else %}
                                                    <span class="text-secondary">–û–∂–∏–¥–∞–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∑–∞—á–µ—Ç–∞</span>
                                                {% endif %}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ç–µ—Å—Ç.</p>
                {% endif %}
            {% endwith %}
        </div>
    </div>

    {% if is_creator %}
        <div class="card mt-4 border-danger">
            <div class="card-body">
                <h5 class="card-title text-danger">–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h5>
                <p class="card-text">–í—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞—á–µ—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.</p>
                <a href="{% url 'delete_quiz_session' quiz_session.id %}" class="btn btn-danger">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–∞—á–µ—Ç
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}